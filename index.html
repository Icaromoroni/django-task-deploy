<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Importando Bootstrap para os estilos da navbar -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Importando Font Awesome para os ícones -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>Minha Lista de Tarefas</title>
    <style>
        body {
  background: linear-gradient(to bottom, #1c2331, #2d3047);
  color: #fff;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}
#search-select {
  appearance: none;
  background-color: #202c3b;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 5px;
  width: 150px;
  font-size: 16px;
  color: #ccc;
}

#search-select option {
  font-size: 16px;
  color: #ccc;
}

.container {
  max-width: 80%;
  margin: 0 auto;
}

.navbar {
  background-color: #202c3b;
  border-bottom: 1px solid #ccc;
}
/* 
.navbar {
  background-color: #fff;
  border-bottom: 1px solid #ccc;
} */

.navbar-brand img {
  max-width: 50px;
}

.list-group-item {
  background-color: rgba(255, 255, 255, 0.1);
  color: #fff;
  border: none;
}

a {
    color: #fff;
}

.list-group-item:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

.btn-outline-primary {
  border-color: #fff;
  color: #fff;
}

.btn-outline-primary:hover {
  background-color: #fff;
  color: #1c2331;
}

.fa-edit, .fa-check, .fa-trash {
  color: #fff;
}

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light">
		<a class="navbar-brand" href="#"><img src="#" alt="Logo"></a>
		<form class="form-inline my-2 my-lg-0 ml-auto" id="search-form">
            <select name="search-select" id="search-select">
                <option selected>Menu de pesquisa</option>
                <option value="situacao">Situação</option>
                <option value="prioridade">Prioridade</option>
                <option value="nivel">Nivel</option>
            </select>
			<input class="form-control mr-sm-2" type="search" placeholder="Pesquisar" aria-label="Pesquisar" id="search-input">
			<button class="btn btn-outline-success my-2 my-sm-0" type="submit"><i class="fas fa-search"></i></button>
		</form>
		<a class="btn btn-outline-primary" href="/formulario.html" role="button"><i class="fas fa-plus"></i> Adicionar tarefa</a>
	</nav>

	<div class="container my-5">
		<h2>Lista de Tarefas</h2>
		<ul class="list-group mt-4" id="list-container">
			<li class="list-group-item d-flex justify-content-between align-items-center">
				Tarefa 1
				<div>
					<a href="#" class="mx-3"><i class="fas fa-edit"></i></a>
					<a href="#" class="mx-3"><i class="fas fa-check"></i></a>
					<a href="#" class="mx-3"><i class="fas fa-trash"></i></a>
				</div>
			</li>
			<li class="list-group-item d-flex justify-content-between align-items-center">
				Tarefa 2
				<div>
					<a href="#" class="mx-3"><i class="fas fa-edit"></i></a>
					<a href="#" class="mx-3"><i class="fas fa-check"></i></a>
					<a href="#" class="mx-3"><i class="fas fa-trash"></i></a>
				</div>
			</li>
			<li class="list-group-item d-flex justify-content-between align-items-center">
				Tarefa 3
				<div>
					<a href="#" class="mx-3"><i class="fas fa-edit"></i></a>
					<a href="#" class="mx-3"><i class="fas fa-check"></i></a>
					<a href="#" class="mx-3"><i class="fas fa-trash"></i></a>
				</div>
			</li>
		</ul>
	</div>
    <script>
        const listContainer = document.querySelector('#list-container');

    function renderTasks() {
        // Faz uma requisição GET para a API
        fetch('http://127.0.0.1:8000/tarefas/')
            .then(response => response.json())
            .then(data => {
            // Limpa a lista atual de tarefas
            listContainer.innerHTML = '';

            // Adiciona cada tarefa na lista
            data.forEach(task => {
                const listItem = document.createElement('li');
                listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');

                const divItem = document.createElement('div');

                const taskName = document.createElement('a');
                taskName.href = '#';
                taskName.classList.add('descricao')
                taskName.innerText = task.descricao;

                const editButton = document.createElement('a');
                editButton.href = '#'
                editButton.classList.add('mx-3');                
                editButton.innerHTML = '<i class="fas fa-edit"></i>';

                const statusButton = document.createElement('a');
                statusButton.href = '#'
                statusButton.classList.add('mx-3');
                statusButton.innerHTML = '<i class="fas fa-check"></i>';

                const deleteButton = document.createElement('a');
                deleteButton.href = '#'
                deleteButton.classList.add('mx-3');
                deleteButton.innerHTML = '<i class="fas fa-trash"></i>';

                
                divItem.appendChild(editButton);
                divItem.appendChild(statusButton);
                divItem.appendChild(deleteButton);

                listItem.appendChild(taskName);
                listItem.appendChild(divItem)

                listContainer.appendChild(listItem);
            });
            });
        }

        // Atualiza a lista de tarefas a cada 5 segundos
        setInterval(renderTasks, 5000);

        const searchForm = document.querySelector('#search-form');
        const searchInput = document.querySelector('#search-input');
        const searchSelect = document.querySelector('#search-select');

        searchForm.addEventListener('submit', (event) => {
        event.preventDefault();

        // Obter a opção selecionada do campo de seleção
        const searchOption = searchSelect.value;

        // Obter o valor digitado no campo de pesquisa
        const searchTerm = searchInput.value;

        // Montar a URL da API com base na opção selecionada
        let apiUrl = 'http://127.0.0.1:8000/tarefas/';
        apiUrl = `http://127.0.0.1:8000/search/?${searchOption}=${searchTerm}`;
        if (searchOption === 'situacao') {
            apiUrl
        } else if (searchOption === 'nivel') {
            apiUrl
        } else if (searchOption === 'prioridade') {
            apiUrl
            
        }

        // Fazer uma requisição GET para a API com a URL montada
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
            // Limpar a lista atual de tarefas
            listContainer.innerHTML = '';

            // Adicionar cada tarefa na lista
            data.forEach(task => {
                const listItem = document.createElement('li');
                listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');

                const taskName = document.createElement('span');
                taskName.innerText = task.descricao;

                const editButton = document.createElement('button');
                editButton.classList.add('btn', 'btn-outline-primary', 'btn-sm', 'mx-3');
                editButton.innerHTML = '<i class="fas fa-edit"></i>';

                const statusButton = document.createElement('button');
                statusButton.classList.add('btn', 'btn-outline-primary', 'btn-sm', 'mx-3');
                statusButton.innerHTML = '<i class="fas fa-check"></i>';

                const deleteButton = document.createElement('button');
                deleteButton.classList.add('btn', 'btn-outline-primary', 'btn-sm', 'mx-3');
                deleteButton.innerHTML = '<i class="fas fa-trash"></i>';

                listItem.appendChild(taskName);
                listItem.appendChild(editButton);
                listItem.appendChild(statusButton);
                listItem.appendChild(deleteButton);

                listContainer.appendChild(listItem);
            });
            });
            });


    </script>
</body>
</html>